<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Basic Example · ProgressiveHedging.jl</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit">ProgressiveHedging.jl</span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Overview</a></li><li><span class="tocitem">Examples</span><ul><li class="is-active"><a class="tocitem" href>Basic Example</a><ul class="internal"><li><a class="tocitem" href="#Problem"><span>Problem</span></a></li><li><a class="tocitem" href="#Setup"><span>Setup</span></a></li><li><a class="tocitem" href="#Subproblem-Creation-Function"><span>Subproblem Creation Function</span></a></li><li><a class="tocitem" href="#Scenario-Tree-Construction"><span>Scenario Tree Construction</span></a></li><li><a class="tocitem" href="#Solution"><span>Solution</span></a></li><li><a class="tocitem" href="#Determining-the-Consensus-Variables"><span>Determining the Consensus Variables</span></a></li><li><a class="tocitem" href="#Extensive-Solve"><span>Extensive Solve</span></a></li></ul></li><li><a class="tocitem" href="../callback/">Callback Example</a></li><li><a class="tocitem" href="../distributed/">Distributed Example</a></li><li><a class="tocitem" href="../multi-stage/">Multi-Stage Example</a></li></ul></li><li><span class="tocitem">Reference</span><ul><li><a class="tocitem" href="../../api/functions/">Low-Level Functions</a></li><li><a class="tocitem" href="../../api/high-level/">High-Level Functions</a></li><li><a class="tocitem" href="../../api/interfaces/">Interfaces</a></li><li><a class="tocitem" href="../../api/types/">Types</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li class="is-active"><a href>Basic Example</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Basic Example</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/NREL/ProgressiveHedging.jl/blob/master/docs/src/examples/basic.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Basic-Example"><a class="docs-heading-anchor" href="#Basic-Example">Basic Example</a><a id="Basic-Example-1"></a><a class="docs-heading-anchor-permalink" href="#Basic-Example" title="Permalink"></a></h1><h2 id="Problem"><a class="docs-heading-anchor" href="#Problem">Problem</a><a id="Problem-1"></a><a class="docs-heading-anchor-permalink" href="#Problem" title="Permalink"></a></h2><p>A basic example using ProgressiveHedging.jl to solve a stochastic program. This example is also available as the script basic_example.jl in the example directory.</p><p>Here we will use ProgressiveHedging.jl to solve the simple problem</p><p><span>$\min_x x + \sum_{s=0}^1 p_s c_s y_s$</span></p><p>subject to</p><p><span>$x \ge 0$</span></p><p><span>$y_s \ge 0, s \in {0,1}$</span></p><p><span>$x + y = b_s$</span></p><p>where</p><p><span>$b_s = \begin{cases} 11, &amp; s=0 \\ 4, &amp; s=1 \end{cases},$</span></p><p><span>$c_s = \begin{cases} 0.5, &amp; s=0 \\ 10, &amp; s=1 \end{cases}$</span></p><p>and for now we will take equally probable scenarios, that is, <span>$p_0 = p_1 = 0.5$</span>.</p><h2 id="Setup"><a class="docs-heading-anchor" href="#Setup">Setup</a><a id="Setup-1"></a><a class="docs-heading-anchor-permalink" href="#Setup" title="Permalink"></a></h2><p>First we need to bring in the needed packages</p><pre><code class="language-julia">using ProgressiveHedging
import JuMP
import Ipopt</code></pre><p>We will need JuMP to build the model for each subproblem and we will use Ipopt to solve each subproblem.</p><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>There are some functions that both JuMP and ProgressiveHedging export. To avoid confusion (and warnings) it is best to import one or both of these packages.</p></div></div><h2 id="Subproblem-Creation-Function"><a class="docs-heading-anchor" href="#Subproblem-Creation-Function">Subproblem Creation Function</a><a id="Subproblem-Creation-Function-1"></a><a class="docs-heading-anchor-permalink" href="#Subproblem-Creation-Function" title="Permalink"></a></h2><p>Next, we write a function that will generate the subproblems for each scenario. The following creates the subproblem for a simple two stage stochastic program.</p><pre><code class="language-julia">function two_stage_model(scenario_id::ScenarioID)

    model = JuMP.Model(()-&gt;Ipopt.Optimizer())
    JuMP.set_optimizer_attribute(model, &quot;print_level&quot;, 0)
    JuMP.set_optimizer_attribute(model, &quot;tol&quot;, 1e-12)
    JuMP.set_optimizer_attribute(model, &quot;acceptable_tol&quot;, 1e-12)

    scen = value(scenario_id)

    ref = JuMP.@variable(model, x &gt;= 0.0)
    stage1 = [ref]

    ref = JuMP.@variable(model, y &gt;= 0.0)
    stage2 = [ref]

    b_s = scen == 0 ? 11.0 : 4.0
	c_s = scen == 0 ? 0.5 : 10.0

    JuMP.@constraint(model, x + y == b_s)

    JuMP.@objective(model, Min, 1.0*x + c_s*y)

    return JuMPSubproblem(model,
                          scenario_id,
                          Dict(stid(1) =&gt; stage1,
                               stid(2) =&gt; stage2)
                          )
end</code></pre><p>There are a few things to note here:</p><ul><li>This function must take as an argument a <a href="../../api/types/#ProgressiveHedging.ScenarioID"><code>ScenarioID</code></a>.</li><li>The mathematical model is built using JuMP.</li><li>The function returns a <a href="../../api/types/#ProgressiveHedging.JuMPSubproblem"><code>JuMPSubproblem</code></a>. This is an implementation of the <a href="../../api/interfaces/#ProgressiveHedging.AbstractSubproblem"><code>AbstractSubproblem</code></a> interface which uses JuMP as the algebraic modeling language.</li><li>In addition to the model, the subproblem also requires the <a href="../../api/types/#ProgressiveHedging.ScenarioID"><code>ScenarioID</code></a> and a dictionary identifying which variables belong in which stage.</li></ul><h2 id="Scenario-Tree-Construction"><a class="docs-heading-anchor" href="#Scenario-Tree-Construction">Scenario Tree Construction</a><a id="Scenario-Tree-Construction-1"></a><a class="docs-heading-anchor-permalink" href="#Scenario-Tree-Construction" title="Permalink"></a></h2><p>Second we need to construct a <a href="../../api/types/#ProgressiveHedging.ScenarioTree"><code>ScenarioTree</code></a> that captures the structure of our stochastic program. We can do this using the <a href="../../api/types/#ProgressiveHedging.ScenarioTree"><code>ScenarioTree</code></a> constructor and the function <a href="../../api/functions/#ProgressiveHedging.add_leaf"><code>add_leaf</code></a>:</p><pre><code class="language-julia">scen_tree = ScenarioTree()
scenario_id_0 = add_leaf(scen_tree, root(scen_tree), 0.5)
scenario_id_1 = add_leaf(scen_tree, root(scen_tree), 0.5)</code></pre><p>Here we created a scenario tree and added two leaf nodes each representing the two scenarios in our problem. We specified both occur with probability 0.5. The other thing to note is that <a href="../../api/functions/#ProgressiveHedging.add_leaf"><code>add_leaf</code></a> returns a <a href="../../api/types/#ProgressiveHedging.ScenarioID"><code>ScenarioID</code></a>. This is a type-safe integer that PH uses to uniquely indentify the each scenario and subproblem. Note that the numbering starts at 0.</p><pre><code class="language-julia">@show scenario_id_0
@show scenario_id_1</code></pre><pre class="documenter-example-output">scenario_id_0 = ScenarioID(0)
scenario_id_1 = ScenarioID(1)</pre><p>The subproblem created by the subproblem creation function should correspond to the path in the scenario tree that leads to this leaf. In our case, we have a two-stage tree and it does not matter which scenario is identified as scenario 0 and scenario 1.</p><p>Since two-stage stochastic programs are extremely common, ProgressiveHedging.jl provides a convenience function to generate two-stage trees with arbitrarily many scenarios: <a href="../../api/functions/#ProgressiveHedging.two_stage_tree"><code>two_stage_tree</code></a>. So we could have used</p><pre><code class="language-julia">scen_tree = two_stage_tree(2)</code></pre><h2 id="Solution"><a class="docs-heading-anchor" href="#Solution">Solution</a><a id="Solution-1"></a><a class="docs-heading-anchor-permalink" href="#Solution" title="Permalink"></a></h2><p>We are now ready to solve the problem. To do so we just use the <a href="../../api/high-level/#ProgressiveHedging.solve"><code>solve</code></a> function and provide it with our scenario tree, the subproblem creation function and a penalty parameter.</p><pre><code class="language-julia">(niter, abs_res, rel_res, obj, soln_df, phd) = solve(scen_tree,
                                                     two_stage_model,
                                                     ScalarPenaltyParameter(1.0)
                                                     )
@show niter
@show abs_res
@show rel_res
@show obj
@show soln_df</code></pre><pre class="documenter-example-output">niter = 39
abs_res = 3.3717478904804885e-6
rel_res = 8.429376739147918e-7
obj = 5.749998288558977
soln_df = 3×4 DataFrame
 Row │ variable  value    stage  scenarios
     │ String    Float64  Int64  String
─────┼─────────────────────────────────────
   1 │ x         4.0          1  0,1
   2 │ y         7.00001      2  0
   3 │ y         0.0          2  1</pre><p>The solve function returns the number of iteration, the absolute and relative residual, the objective value, a <code>DataFrame</code> containing the solution and, lastly, a <a href="../../api/types/#ProgressiveHedging.PHData"><code>PHData</code></a> instance.</p><p>The <a href="../../api/types/#ProgressiveHedging.PHData"><code>PHData</code></a> contains additional information like the dual (Lagrange multiplier) values for the nonanticipativity constraints</p><pre><code class="language-julia">dual_df = retrieve_w(phd)
@show dual_df</code></pre><pre class="documenter-example-output">dual_df = 2×5 DataFrame
 Row │ variable  value    stage  scenario  index
     │ String    Float64  Int64  Int64     Int64
─────┼───────────────────────────────────────────
   1 │ W_x          -0.5      1         0      1
   2 │ W_x           0.5      1         1      1</pre><p>as well as the raw values of the consensus contributing variables</p><pre><code class="language-julia">raw_values_df = retrieve_no_hats(phd)
@show raw_values_df</code></pre><pre class="documenter-example-output">raw_values_df = 4×5 DataFrame
 Row │ variable  value    stage  scenario  index
     │ String    Float64  Int64  Int64     Int64
─────┼───────────────────────────────────────────
   1 │ x         3.99999      1         0      1
   2 │ x         4.0          1         1      1
   3 │ y         7.00001      2         0      1
   4 │ y         0.0          2         1      1</pre><h2 id="Determining-the-Consensus-Variables"><a class="docs-heading-anchor" href="#Determining-the-Consensus-Variables">Determining the Consensus Variables</a><a id="Determining-the-Consensus-Variables-1"></a><a class="docs-heading-anchor-permalink" href="#Determining-the-Consensus-Variables" title="Permalink"></a></h2><div class="admonition is-info"><header class="admonition-header">Determining the Consensus Variables</header><div class="admonition-body"><p>You may notice that we never specifically indicated which variables needed nonanticipativity constraints. ProgressiveHedging determines this automatically for us using the scenario tree we constructed, the stage the variable is in and the name the variable is given. When using the <a href="../../api/types/#ProgressiveHedging.JuMPSubproblem"><code>JuMPSubproblem</code></a>, the name of the variable is determined by calling the function <code>JuMP.name</code> on each <code>JuMP.VariableRef</code> object. The stage is given by the dictionary given to the <a href="../../api/types/#ProgressiveHedging.JuMPSubproblem"><code>JuMPSubproblem</code></a> constructor as seen in the subproblem creation function above. This is possible because the combination of a <a href="../../api/types/#ProgressiveHedging.ScenarioID"><code>ScenarioID</code></a> and a <a href="../../api/types/#ProgressiveHedging.StageID"><code>StageID</code></a> uniquely determine a node on the scenario tree. Any variables with the same names that belong to this node are assumed to require nonanticipativity constraints and so are identified as consensus variables.</p></div></div><h2 id="Extensive-Solve"><a class="docs-heading-anchor" href="#Extensive-Solve">Extensive Solve</a><a id="Extensive-Solve-1"></a><a class="docs-heading-anchor-permalink" href="#Extensive-Solve" title="Permalink"></a></h2><p>For smaller problems, it is also possible to solve the extensive form of the problem directly. ProgressiveHedging.jl is capable of building the extensive form from the previously defined function and scenario tree.</p><pre><code class="language-julia">ef_model = solve_extensive(scen_tree,
                           two_stage_model,
                           ()-&gt;Ipopt.Optimizer(),
                           opt_args=(print_level=0, tol=1e-12, acceptable_tol=1e-12)
                           )</code></pre><p>This function builds, optimizes and returns a JuMP model of the extensive form. As such, information is obtained from it as from any other JuMP model.</p><pre><code class="language-julia">@show JuMP.termination_status(ef_model)
@show JuMP.objective_value(ef_model)
for v in JuMP.all_variables(ef_model)
    println(&quot;$v = $(JuMP.value(v))&quot;)
end</code></pre><pre class="documenter-example-output">JuMP.termination_status(ef_model) = MathOptInterface.LOCALLY_SOLVED
JuMP.objective_value(ef_model) = 5.749999957500125
y_{0} = 6.99999999000003
x_{0,1} = 4.00000000999997
y_{1} = 0.0</pre><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>The subscripts in the variable names are the scenarios to which the variable belongs.</p></div></div></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../../">« Overview</a><a class="docs-footer-nextpage" href="../callback/">Callback Example »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Wednesday 9 June 2021 19:16">Wednesday 9 June 2021</span>. Using Julia version 1.6.1.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
